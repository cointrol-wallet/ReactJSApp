import{a,j as e,b as Q}from"./vendor-react-C4KqQK9E.js";import{u as Ne}from"./useContacts-DNmaZ8iJ.js";import{u as Ce}from"./useAddresses-Dn19ycjZ.js";import{a as Se,S as ke}from"./shareBuilders-BefOSag0.js";import"./index-CIWIx-KU.js";import"./vendor-viem-BanhIei1.js";import"./vendor-qr-BZDEmg8j.js";import"./vendor-firebase-CrtqWl9v.js";function Ae(j,m="createdAsc"){const c=[...j];return m==="nameAsc"?c.sort((d,l)=>d.name.toLocaleLowerCase().localeCompare(l.name.toLocaleLowerCase())):m==="createdDesc"?c.sort((d,l)=>l.createdAt-d.createdAt):m==="nameDesc"?c.sort((d,l)=>l.name.toLocaleLowerCase().localeCompare(d.name.toLocaleLowerCase())):m==="surnameDesc"?c.sort((d,l)=>{const g=d.surname?.toLowerCase()??"";return(l.surname?.toLowerCase()??"").localeCompare(g)}):m==="surnameAsc"?c.sort((d,l)=>{const g=d.surname?.toLowerCase()??"",v=l.surname?.toLowerCase()??"";return g.localeCompare(v)}):m==="createdAsc"&&c.sort((d,l)=>d.createdAt-l.createdAt),c}function Ee(j={}){const{contacts:m,loading:c,error:d,addContact:l,updateContact:g,deleteContact:v,clearContacts:R}=Ne(),{query:C="",sortMode:L="nameAsc",tags:p=[],tagMode:y="any"}=j;return{contacts:a.useMemo(()=>{let u=m;if(C.trim()){const f=C.trim().toLowerCase();u=u.filter(h=>h.name.toLowerCase().includes(f)||h.surname?.toLowerCase().includes(f))}return p&&p.length>0&&(y=="any"?u=u.filter(f=>f.tags?.some(h=>p.includes(h))):u=u.filter(f=>p.every(h=>f.tags?.includes(h)))),Ae(u,L)},[m,C,L,p,y]),loading:c,error:d,addContact:l,updateContact:g,deleteContact:v,clearContacts:R}}function We(){const[j,m]=a.useState(""),[c,d]=a.useState("nameAsc"),[l,g]=a.useState([]),[v,R]=a.useState("any"),[C,L]=a.useState(""),[p,y]=a.useState(!1),[S,u]=a.useState(null),[f,h]=a.useState(null),[Y,P]=a.useState(""),[$,W]=a.useState(""),[M,D]=a.useState([]),[G,I]=a.useState(""),[T,k]=a.useState([]),[z,O]=a.useState(null),re=/^0x[0-9a-fA-F]{40}$/,ae=/^[a-z0-9-]+\.eth$/i,K={1:"Ethereum",11155111:"Sepolia"},{address:V,addAddress:ne,updateAddress:oe}=Ce(),{contacts:X,loading:de,error:U,addContact:le,deleteContact:ie,updateContact:ce}=Ee({query:j,sortMode:c,tags:l,tagMode:v});function me({sortMode:t,setSortMode:s,tagSearch:r,setTagSearch:i,setTags:n,tagMode:x,setTagSearchMode:A}){const[w,se]=a.useState(!1),q=a.useRef(null),[H,ve]=a.useState({top:0,left:0,width:320}),Z=()=>se(!1),N=a.useCallback(()=>{if(!q.current)return;const o=q.current.getBoundingClientRect(),b=8,E=Math.min(360,window.innerWidth-b*2),B=o.bottom+8,ye=o.right-E,we=Math.min(Math.max(b,ye),window.innerWidth-E-b);ve({top:B,left:we,width:E})},[]),je=()=>{const o=!w;o&&N(),se(o)};return a.useEffect(()=>{if(!w)return;const o=b=>{b.key==="Escape"&&Z()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[w]),a.useEffect(()=>{if(w)return window.addEventListener("resize",N),window.addEventListener("scroll",N,!0),()=>{window.removeEventListener("resize",N),window.removeEventListener("scroll",N,!0)}},[w,N]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:q,type:"button",className:"h-9 whitespace-nowrap rounded-md border border-border bg-card px-3 text-sm text-foreground",onClick:je,children:" Sort / Filter "}),w&&typeof document<"u"&&Q.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:Z,style:{position:"fixed",inset:0,zIndex:9998,background:"rgba(0,0,0,0.35)"}}),e.jsxs("div",{className:"rounded-xl border border-border bg-card shadow-lg",style:{position:"fixed",zIndex:9999,top:H.top,left:H.left,width:H.width,padding:12},onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Sort"}),e.jsxs("select",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground",value:t,onChange:o=>s(o.target.value),children:[e.jsx("option",{value:"nameAsc",children:"Name (A → Z)"}),e.jsx("option",{value:"nameDesc",children:"Name (Z → A)"}),e.jsx("option",{value:"surnameAsc",children:"Surname (A → Z)"}),e.jsx("option",{value:"surnameDesc",children:"Surname (Z → A)"}),e.jsx("option",{value:"createdDesc",children:"Newest first"}),e.jsx("option",{value:"createdAsc",children:"Oldest first"})]}),e.jsx("div",{className:"my-3 border-t border-border"}),e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Filter by tags"}),e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground placeholder:text-muted",placeholder:"Comma-separated tags…",value:r,onChange:o=>{const b=o.target.value;i(b);const E=b.split(",").map(B=>B.trim()).filter(Boolean);n(E)}}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted",children:"Mode"}),e.jsxs("select",{className:"h-9 flex-1 rounded-md border border-border bg-background px-2 text-sm text-foreground",value:x,onChange:o=>A(o.target.value),children:[e.jsx("option",{value:"any",children:"Match any"}),e.jsx("option",{value:"all",children:"Match all"})]}),e.jsx("button",{type:"button",className:"h-9 rounded-md border border-border bg-card px-3 text-sm hover:bg-muted",onClick:()=>{i(""),n([]),A("any")},children:"Clear"})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"h-9 rounded-md bg-primary px-3 text-sm text-primary-foreground",onClick:Z,children:"Done"})})]})]}),document.body)]})}function ue(t,s){_[t.id]?oe(t.id,{name:t.name,isVisible:s,group:t.tags??[]}):ne({id:t.id,name:t.name,isVisible:s,group:t.tags??[],isContact:!0,indexOrder:0})}const _=a.useMemo(()=>{const t={};return V.forEach(s=>{t[s.id]=s}),t},[V]);a.useEffect(()=>{function t(s){s.target.closest("details")||document.querySelectorAll("details[open]").forEach(i=>{i.removeAttribute("open")})}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),a.useEffect(()=>{if(!p)return;const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}},[p]);function J(){P(""),W(""),D([]),I(""),k([])}function xe(){u(null),J(),y(!0)}function pe(t){u(t),P(t.name??""),W(t.surname??""),D(t.tags??[]),I(""),k(t.wallets??[]),y(!0)}function F(){y(!1),u(null),J()}function ee(){const t=G.trim();if(!t)return;const s=t.split(",").map(r=>r.trim()).filter(Boolean);D(r=>{const i=new Set(r.map(x=>x.toLowerCase())),n=[...r];for(const x of s)i.has(x.toLowerCase())||n.push(x);return n}),I("")}function fe(t){D(s=>s.filter(r=>r!==t))}function te(t,s,r){k(i=>{const n=[...i],x={...n[t]};if(s==="chainId"){const A=typeof r=="number"?r:Number(r);Number.isFinite(A)&&(x.chainId=A)}else x.address=String(r);return n[t]=x,n})}function he(){k(t=>[...t,{chainId:1,address:""}])}function be(t){k(s=>s.filter((r,i)=>i!==t))}async function ge(t){t.preventDefault();const s=T.map(n=>({...n,address:n.address.trim()})).filter(n=>n.address!=="");for(const n of s)if(!re.test(n.address)&&!ae.test(n.address)){alert(`Invalid wallet address: ${n.address}`);return}const r=Y.trim();if(!r)return;const i={name:r,surname:$.trim()||void 0,tags:M.length>0?M:void 0,wallets:T.filter(n=>n.address.trim()).filter(n=>n.chainId>0)};S?await ce(S.id,i):await le(i),F()}return de?e.jsx("div",{className:"p-4",children:"Loading contacts…"}):U?e.jsx("div",{className:"p-4 text-red-600",children:U}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("h1",{className:"shrink-0 text-2xl leading-tight font-semibold text-foreground",children:"Contacts"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-card px-2 text-sm text-foreground placeholder:text-muted sm:max-w-md",placeholder:"Search by name or address…",value:j,onChange:t=>m(t.target.value)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(me,{sortMode:c,setSortMode:d,tagSearch:C,setTagSearch:L,setTags:g,tagMode:v,setTagSearchMode:R})," ",e.jsx("button",{className:"h-9 rounded-md border border-border bg-card px-3 text-sm",onClick:xe,children:" + Add contact "})]})]}),X.length===0?e.jsx("div",{className:"text-sm text-muted",children:"No contacts yet. Add one from the transaction screen or here."}):e.jsx("ul",{className:"space-y-2",children:X.map(t=>e.jsx("li",{className:"w-full",children:e.jsx("div",{className:"w-full rounded-lg border border-border bg-card px-4 py-3",children:e.jsxs("div",{className:"grid gap-3 sm:gap-x-6 sm:gap-y-2 sm:grid-cols-[160px_90px_minmax(0,1fr)_110px] sm:items-start",children:[e.jsx("div",{className:"min-w-0 font-medium",children:t.name}),e.jsx("div",{className:"min-w-0 text-xs text-muted-foreground sm:pt-1",children:t.surname}),e.jsxs("div",{className:"min-w-0",children:[t.wallets?.length>0&&e.jsx("div",{className:"space-y-1",children:t.wallets.map((s,r)=>e.jsxs("div",{className:"text-xs text-muted-foreground font-mono break-words sm:truncate sm:break-normal",title:s.address,children:[K[s.chainId]??s.chainId,": ",s.address]},r))}),t.tags&&t.tags?.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:t.tags.map(s=>e.jsxs("span",{className:"rounded-full border border-border px-2 py-0.5",children:["#",s]},s))})]}),e.jsx("div",{className:"justify-self-start sm:justify-self-end",children:e.jsxs("details",{className:"relative inline-block",children:[e.jsx("summary",{className:"cursor-pointer list-none rounded-md border border-border bg-background px-2 py-1 text-xs",children:"Actions"}),e.jsxs("div",{className:"absolute left-0 sm:right-0 sm:left-auto mt-1 w-40 rounded-md border border-border bg-background shadow-lg z-50",children:[e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),pe(t)},children:"Edit"}),e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),ue(t,!(_[t.id]?.isVisible??!0))},children:_[t.id]?.isVisible??!0?"Hide":"Show"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs text-red-600 hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),O(t.id)},children:"Remove"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.preventDefault(),s.stopPropagation(),h(Se(t))},children:"Share"})]})]})})]})})},t.id))}),p?Q.createPortal(e.jsx("div",{className:"bg-background/80 backdrop-blur-sm",onClick:t=>{t.target===t.currentTarget&&F()},style:{position:"fixed",inset:0,zIndex:2147483647,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{className:"bg-background",onMouseDown:t=>t.stopPropagation(),style:{width:"100%",maxWidth:448,borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[e.jsx("h2",{className:"mb-3 text-base font-semibold",children:S?"Edit contact":"Add contact"}),e.jsxs("form",{className:"space-y-4",onSubmit:ge,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Name"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm",value:Y,onChange:t=>P(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Surname (optional)"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm",value:$,onChange:t=>W(t.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-md border px-2 py-1 text-sm",placeholder:"Type a tag and press Enter or comma…",value:G,onChange:t=>I(t.target.value),onKeyDown:t=>{(t.key==="Enter"||t.key===",")&&(t.preventDefault(),ee())}}),e.jsx("button",{type:"button",className:"rounded-md border px-2 py-1 text-xs",onClick:ee,children:"Add"})]}),M.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-muted",children:M.map(t=>e.jsxs("button",{type:"button",className:"flex items-center gap-1 rounded-full border px-2 py-0.5",onClick:()=>fe(t),title:"Click to remove",children:[e.jsxs("span",{children:["#",t]}),e.jsx("span",{"aria-hidden":!0,children:"×"})]},t))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Wallets"}),T.length===0&&e.jsx("div",{className:"text-[11px] text-muted",children:"No wallets yet."}),e.jsx("div",{className:"space-y-2",children:T.map((t,s)=>e.jsxs("div",{className:"grid gap-2 rounded-md border px-2 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("select",{className:"h-8 w-28 rounded-md border px-2 text-xs",value:t.chainId,onChange:r=>te(s,"chainId",Number(r.target.value)),children:Object.entries(K).map(([r,i])=>e.jsx("option",{value:r,children:i},r))}),e.jsx("button",{type:"button",className:"shrink-0 whitespace-nowrap text-[11px] text-red-600 underline",onClick:()=>be(s),children:"Remove"})]}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-xs font-mono",placeholder:"0x...",value:t.address,onChange:r=>te(s,"address",r.target.value)})]},s))}),e.jsx("button",{type:"button",className:"mt-1 rounded-md border px-2 py-1 text-xs",onClick:he,children:"+ Add wallet"})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"rounded-md border px-3 py-1 text-xs",onClick:F,children:"Cancel"}),e.jsx("button",{type:"submit",className:"rounded-md bg-primary px-3 py-1 text-xs font-medium text-background",children:S?"Save changes":"Create contact"})]})]})]})}),document.body):null,z?Q.createPortal(e.jsx("div",{onClick:t=>{t.target===t.currentTarget&&F()},style:{position:"fixed",inset:0,zIndex:2147483647,background:"rgba(0,0,0,0.35)",backdropFilter:"blur(6px)",overflowY:"auto",WebkitOverflowScrolling:"touch",padding:16,minHeight:"100dvh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{width:"min(448px, calc(100dvw - 32px))",borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)",background:"#fff",color:"#111",maxHeight:"calc(100dvh - 32px)",overflowY:"auto"},children:[e.jsx("h2",{className:"text-base font-semibold",children:"Delete contact?"}),e.jsx("p",{className:"mt-2 text-sm text-muted",children:"This will delete the contact and remove it from your address book. This action cannot be undone."}),e.jsxs("div",{className:"mt-4 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",children:[e.jsx("button",{className:"rounded-md border px-3 py-2 text-sm",onClick:()=>O(null),children:"Cancel"}),e.jsx("button",{className:"rounded-md bg-primary px-3 py-2 text-sm text-background",onClick:()=>{z&&ie(z),O(null)},children:"Yes, delete contact"})]})]})}),document.body):null,f&&e.jsx(ke,{payload:f,onClose:()=>h(null)})]})}export{We as Contacts};
