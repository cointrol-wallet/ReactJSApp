import{a as d,j as e,R as q,u as _,b as G}from"./vendor-react-C4KqQK9E.js";import{s as J,u as X}from"./useAddressList-B-biZcvv.js";import{u as Y,a as ee,D as te,c as se,S as re,v as ne,b as oe,P as de,d as ae,C as ie}from"./vendor-dnd-CTbvfi1l.js";import{e as ce,g as le}from"./index-BRJ5KNqN.js";import{u as ue}from"./useCoinList-CHGj9T2_.js";import{u as me}from"./useContacts-DOhn3MyE.js";import{u as xe}from"./useContracts-Dxjw8SWs.js";import"./useAddresses-DiwOqGrw.js";import"./vendor-viem-BanhIei1.js";import"./vendor-qr-BZDEmg8j.js";import"./vendor-firebase-CrtqWl9v.js";function pe({items:s,sortMode:a,onReorder:N,onHide:b,coins:S,contacts:k,contracts:A,onSendCoins:h,onApproveCoins:I,onUseContract:c}){const l=d.useMemo(()=>{const o=s.filter(u=>u.isVisible!==!1);return J(o,a)},[s,a]),x=Y(ee(de,{activationConstraint:{distance:5}}));function E(o){if(a!=="custom")return;const{active:u,over:g}=o;if(!g||u.id===g.id)return;const f=l.findIndex(m=>m.id===u.id),v=l.findIndex(m=>m.id===g.id);if(f===-1||v===-1)return;const j=oe(l,f,v).map((m,M)=>({...m,indexOrder:M}));N(j)}return e.jsx(te,{sensors:x,collisionDetection:se,onDragEnd:E,children:e.jsx(re,{items:l.map(o=>o.id),strategy:ne,children:e.jsx("div",{className:"space-y-2",children:l.map(o=>e.jsx(be,{item:o,draggable:a==="custom",onHide:b,coins:S,contacts:k,onSendCoins:h,onApproveCoins:I,onUseContract:c,contracts:A},o.id))})})})}function be({item:s,draggable:a,onHide:N,coins:b,contacts:S,contracts:k,onSendCoins:A,onApproveCoins:h,onUseContract:I}){const[c,l]=q.useState(""),[x,E]=q.useState(""),o=s.id.replace(/^address:/,""),u=o,g=s.isContact?S.find(t=>t.id===u):void 0,f=new Set(g?.wallets?.map(t=>t.chainId)??[]),v=s.isContact?b.filter(t=>f.has(t.chainId)):[],j=s.isContact?void 0:k.find(t=>t.id===o),m=j?ce(j.metadata):null,M=le(m),{attributes:L,listeners:R,setNodeRef:P,transform:z,transition:r,isDragging:i}=ae({id:s.id}),D={transform:ie.Transform.toString(z),transition:r,opacity:i?.6:1,cursor:a?"grab":"default"};return e.jsx("div",{ref:P,style:D,className:"w-full",children:e.jsx("div",{className:"w-full rounded-lg border border-border bg-card px-4 py-3",children:e.jsxs("div",{className:"grid gap-3 sm:gap-x-6 sm:gap-y-2 sm:grid-cols-[minmax(0,1fr)_110px] sm:items-start",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.group&&s.group.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:s.group.map(t=>e.jsxs("span",{className:"rounded-full border border-border px-2 py-0.5",children:["#",t]},t))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.isContact&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"h-7 rounded border border-border bg-background px-1 text-xs text-foreground",value:c,onChange:t=>l(t.target.value),children:[e.jsx("option",{value:"",children:"Coin…"}),v.map(t=>e.jsx("option",{value:t.id,children:t.symbol},t.id))]}),e.jsx("button",{disabled:!c,className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted disabled:opacity-40",onClick:()=>A(s,c),children:"Send"}),e.jsx("button",{disabled:!c,className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted disabled:opacity-40",onClick:()=>h(s,c),children:"Approve"})]}),!s.isContact&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"h-7 w-28 rounded border border-border bg-background px-1 text-xs text-foreground",value:x,onChange:t=>E(t.target.value),children:[e.jsx("option",{value:"",children:"Function…"}),M.map(t=>e.jsxs("option",{value:t.name,children:[t.name,"(",t.inputs.map(y=>y.type).join(","),")"]},`${t.name}(${t.inputs.map(y=>y.type).join(",")})`))]}),e.jsx("button",{disabled:!x,className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted disabled:opacity-40",onClick:()=>I(s,x),children:"Use"})]}),e.jsx("button",{type:"button",...a?{...L,...R}:{},className:"text-xs text-muted-foreground hover:text-foreground disabled:opacity-40",disabled:!a,children:"☰"}),e.jsx("button",{onClick:()=>N(s.id),className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted",children:"Hide"})]})]})})})}function Ae(){const s=_(),[a,N]=d.useState(""),[b,S]=d.useState("nameAsc"),[k,A]=d.useState([]),[h,I]=d.useState("any"),[c,l]=d.useState(""),{address:x,loading:E,error:o,updateAddress:u}=X({query:a,sortMode:b,tags:k,tagMode:h}),{coins:g}=ue({query:"",sortMode:"nameAsc",standard:"",chainId:0}),{contacts:f}=me(),{contracts:v}=xe();function j(r,i){s("/transactions",{state:{prefill:{mode:"transfer",addressId:r.id,coinId:i}}})}function m(r,i){s("/transactions",{state:{prefill:{mode:"transfer",addressId:r.id,coinId:i,functionName:"approve"}}})}function M(r,i){s("/transactions",{state:{prefill:{mode:"contract",addressId:r.id,functionName:i}}})}function L({sortMode:r,setSortMode:i,tagSearch:D,setTagSearch:t,setTags:y,tagMode:W,setTagSearchMode:U}){const[C,V]=d.useState(!1),B=d.useRef(null),[O,Z]=d.useState({top:0,left:0,width:320}),T=()=>V(!1),w=d.useCallback(()=>{if(!B.current)return;const n=B.current.getBoundingClientRect(),p=8,F=Math.min(360,window.innerWidth-p*2),H=n.bottom+8,K=n.right-F,Q=Math.min(Math.max(p,K),window.innerWidth-F-p);Z({top:H,left:Q,width:F})},[]),$=()=>{const n=!C;n&&w(),V(n)};return d.useEffect(()=>{if(!C)return;const n=p=>{p.key==="Escape"&&T()};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[C]),d.useEffect(()=>{if(C)return window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),()=>{window.removeEventListener("resize",w),window.removeEventListener("scroll",w,!0)}},[C,w]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:B,type:"button",className:"h-9 whitespace-nowrap rounded-md border border-border bg-card px-3 text-sm text-foreground",onClick:$,children:"Sort / Filter"}),C&&typeof document<"u"&&G.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:T,style:{position:"fixed",inset:0,zIndex:9998,background:"rgba(0,0,0,0.35)"}}),e.jsxs("div",{className:"rounded-xl border border-border bg-card shadow-lg",style:{position:"fixed",zIndex:9999,top:O.top,left:O.left,width:O.width,padding:12},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Sort"}),e.jsxs("select",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground",value:r,onChange:n=>i(n.target.value),children:[e.jsx("option",{value:"nameAsc",children:"Name (A → Z)"}),e.jsx("option",{value:"nameDesc",children:"Name (Z → A)"}),e.jsx("option",{value:"createdDesc",children:"Newest first"}),e.jsx("option",{value:"createdAsc",children:"Oldest first"})]}),e.jsx("div",{className:"my-3 border-t border-border"}),e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Filter by tags"}),e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground placeholder:text-muted",placeholder:"Comma-separated tags…",value:D,onChange:n=>{const p=n.target.value;t(p);const F=p.split(",").map(H=>H.trim()).filter(Boolean);y(F)}}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted",children:"Mode"}),e.jsxs("select",{className:"h-9 flex-1 rounded-md border border-border bg-background px-2 text-sm text-foreground",value:W,onChange:n=>U(n.target.value),children:[e.jsx("option",{value:"any",children:"Match any"}),e.jsx("option",{value:"all",children:"Match all"})]}),e.jsx("button",{type:"button",className:"h-9 rounded-md border border-border bg-card px-3 text-sm hover:bg-muted",onClick:()=>{t(""),y([]),U("any")},children:"Clear"})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"h-9 rounded-md bg-primary px-3 text-sm text-primary-foreground",onClick:T,children:"Done"})})]})]}),document.body)]})}const R=d.useMemo(()=>x.filter(r=>r.isVisible!==!1),[x]);async function P(r){await Promise.all(r.map((i,D)=>u(i.id,{indexOrder:D})))}async function z(r){await u(r,{isVisible:!1})}return E?e.jsx("div",{className:"p-4",children:"Loading Address…"}):o?e.jsx("div",{className:"p-4 text-red-600",children:o}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("h1",{className:"shrink-0 text-2xl leading-tight font-semibold text-foreground",children:"Address Book"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-card px-2 text-sm text-foreground placeholder:text-muted sm:max-w-md",placeholder:"Search by name or address…",value:a,onChange:r=>N(r.target.value)}),e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2",children:e.jsx(L,{sortMode:b,setSortMode:S,tagSearch:c,setTagSearch:l,setTags:A,tagMode:h,setTagSearchMode:I})})]}),e.jsx(pe,{items:R,sortMode:b,onReorder:P,onHide:z,coins:g,contacts:f,contracts:v,onSendCoins:j,onApproveCoins:m,onUseContract:M})]})}export{Ae as AddressBook};
