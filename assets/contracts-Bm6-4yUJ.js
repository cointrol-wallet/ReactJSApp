import{a as r,j as e,b as Q}from"./vendor-react-C4KqQK9E.js";import{u as we}from"./useContracts-DMMoimvH.js";import{u as Ne}from"./useAddresses-Dn19ycjZ.js";import{b as Ce,S as Se}from"./shareBuilders-BefOSag0.js";import"./index-CIWIx-KU.js";import"./vendor-viem-BanhIei1.js";import"./vendor-qr-BZDEmg8j.js";import"./vendor-firebase-CrtqWl9v.js";function ke(b,i="createdAsc"){const l=[...b];return i==="nameAsc"?l.sort((a,o)=>a.name.toLocaleLowerCase().localeCompare(o.name.toLocaleLowerCase())):i==="nameDesc"?l.sort((a,o)=>o.name.toLocaleLowerCase().localeCompare(a.name.toLocaleLowerCase())):i==="createdAsc"?l.sort((a,o)=>a.createdAt-o.createdAt):i==="createdDesc"?l.sort((a,o)=>o.createdAt-a.createdAt):i==="chainIdAsc"?l.sort((a,o)=>a.chainId-o.chainId):i==="chainIdDesc"?l.sort((a,o)=>o.chainId-a.chainId):i==="addressAsc"?l.sort((a,o)=>a.address.toLocaleLowerCase().localeCompare(o.address.toLocaleLowerCase())):i==="addressDesc"&&l.sort((a,o)=>o.address.toLocaleLowerCase().localeCompare(a.address.toLocaleLowerCase())),l}function Ae(b={}){const{contracts:i,loading:l,error:a,addContract:o,updateContract:T,deleteContract:k,clearContracts:F}=we(),{query:w="",sortMode:A="nameAsc",tags:u=[],tagMode:g="any",chainId:p=0}=b;return{contracts:r.useMemo(()=>{let c=i;if(w.trim()){const m=w.trim().toLowerCase();c=c.filter(x=>x.name.toLowerCase().includes(m)||x.address.toLowerCase().includes(m))}return p&&(c=c.filter(m=>m.chainId===p)),u&&u.length>0&&(g=="any"?c=c.filter(m=>m.tags?.some(x=>u.includes(x))):c=c.filter(m=>u.every(x=>m.tags?.includes(x)))),ke(c,A)},[i,w,A,g,u,p]),loading:l,error:a,addContract:o,updateContract:T,deleteContract:k,clearContracts:F}}function Pe(){const[b,i]=r.useState(""),[l,a]=r.useState("nameAsc"),[o,T]=r.useState([]),[k,F]=r.useState("any"),[w,A]=r.useState(""),[u,g]=r.useState(!1),[p,E]=r.useState(null),[c,m]=r.useState(null),[x,O]=r.useState(""),[Y,P]=r.useState(""),[G,R]=r.useState(1),[I,L]=r.useState([]),[K,M]=r.useState(""),[z,N]=r.useState(""),[B,_]=r.useState(null),ae=/^0x[0-9a-fA-F]{40}$/,oe=/^[a-z0-9-]+\.eth$/i,V={1:"Ethereum",11155111:"Sepolia"},{address:X,addAddress:ne,updateAddress:de}=Ne(),{contracts:$,loading:le,error:U,addContract:ie,deleteContract:ce,updateContract:me}=Ae({query:b,sortMode:l,tags:o,tagMode:k});function ue({sortMode:t,setSortMode:s,tagSearch:n,setTagSearch:f,setTags:C,tagMode:v,setTagSearchMode:se}){const[j,re]=r.useState(!1),H=r.useRef(null),[J,ge]=r.useState({top:0,left:0,width:320}),W=()=>re(!1),y=r.useCallback(()=>{if(!H.current)return;const d=H.current.getBoundingClientRect(),h=8,S=Math.min(360,window.innerWidth-h*2),Z=d.bottom+8,je=d.right-S,ye=Math.min(Math.max(h,je),window.innerWidth-S-h);ge({top:Z,left:ye,width:S})},[]),ve=()=>{const d=!j;d&&y(),re(d)};return r.useEffect(()=>{if(!j)return;const d=h=>{h.key==="Escape"&&W()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[j]),r.useEffect(()=>{if(j)return window.addEventListener("resize",y),window.addEventListener("scroll",y,!0),()=>{window.removeEventListener("resize",y),window.removeEventListener("scroll",y,!0)}},[j,y]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:H,type:"button",className:"h-9 whitespace-nowrap rounded-md border border-border bg-card px-3 text-sm text-foreground",onClick:ve,children:"Sort / Filter"}),j&&typeof document<"u"&&Q.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:W,style:{position:"fixed",inset:0,zIndex:9998,background:"rgba(0,0,0,0.35)"}}),e.jsxs("div",{className:"rounded-xl border border-border bg-card shadow-lg",style:{position:"fixed",zIndex:9999,top:J.top,left:J.left,width:J.width,padding:12},onClick:d=>d.stopPropagation(),children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Sort"}),e.jsxs("select",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground",value:t,onChange:d=>s(d.target.value),children:[e.jsx("option",{value:"nameAsc",children:"Name (A → Z)"}),e.jsx("option",{value:"nameDesc",children:"Name (Z → A)"}),e.jsx("option",{value:"surnameAsc",children:"Surname (A → Z)"}),e.jsx("option",{value:"surnameDesc",children:"Surname (Z → A)"}),e.jsx("option",{value:"createdDesc",children:"Newest first"}),e.jsx("option",{value:"createdAsc",children:"Oldest first"})]}),e.jsx("div",{className:"my-3 border-t border-border"}),e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Filter by tags"}),e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground placeholder:text-muted",placeholder:"Comma-separated tags…",value:n,onChange:d=>{const h=d.target.value;f(h);const S=h.split(",").map(Z=>Z.trim()).filter(Boolean);C(S)}}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted",children:"Mode"}),e.jsxs("select",{className:"h-9 flex-1 rounded-md border border-border bg-background px-2 text-sm text-foreground",value:v,onChange:d=>se(d.target.value),children:[e.jsx("option",{value:"any",children:"Match any"}),e.jsx("option",{value:"all",children:"Match all"})]}),e.jsx("button",{type:"button",className:"h-9 rounded-md border border-border bg-card px-3 text-sm hover:bg-muted",onClick:()=>{f(""),C([]),se("any")},children:"Clear"})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"h-9 rounded-md bg-primary px-3 text-sm text-primary-foreground",onClick:W,children:"Done"})})]})]}),document.body)]})}function xe(t,s){q[t.id]?de(t.id,{name:t.name,isVisible:s,group:t.tags??[]}):ne({id:t.id,name:t.name,isVisible:s,group:t.tags??[],isContact:!1,indexOrder:0})}const q=r.useMemo(()=>{const t={};return X.forEach(s=>{t[s.id]=s}),t},[X]);r.useEffect(()=>{function t(s){s.target.closest("details")||document.querySelectorAll("details[open]").forEach(f=>{f.removeAttribute("open")})}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),r.useEffect(()=>{if(!u)return;const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}},[u]);function ee(){O(""),P(""),L([]),R(1),M(""),N("")}function pe(){E(null),ee(),g(!0)}function fe(t){E(t),O(t.name??""),P(t.address??""),R(t.chainId??1),L(t.tags??[]),M(""),t.metadata?.ABI?N(JSON.stringify(t.metadata.ABI,null,2)):N(""),g(!0)}function D(){g(!1),E(null),ee()}function te(){const t=K.trim();if(!t)return;const s=t.split(",").map(n=>n.trim()).filter(Boolean);L(n=>{const f=new Set(n.map(v=>v.toLowerCase())),C=[...n];for(const v of s)f.has(v.toLowerCase())||C.push(v);return C}),M("")}function he(t){L(s=>s.filter(n=>n!==t))}async function be(t){t.preventDefault();const s=x.trim();if(!s)return;const n={name:s,address:Y.trim()||void 0,chainId:G||void 0,tags:I.length>0?I:void 0,metadata:z.trim()?{ABI:JSON.parse(z)}:void 0};p?await me(p.id,n):await ie(n),D()}return le?e.jsx("div",{className:"p-4",children:"Loading contracts…"}):U?e.jsx("div",{className:"p-4 text-red-600",children:U}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("h1",{className:"shrink-0 text-2xl leading-tight font-semibold text-foreground",children:"Smart Contracts"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-card px-2 text-sm text-foreground placeholder:text-muted sm:max-w-md",placeholder:"Search by name or address…",value:b,onChange:t=>i(t.target.value)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(ue,{sortMode:l,setSortMode:a,tagSearch:w,setTagSearch:A,setTags:T,tagMode:k,setTagSearchMode:F})," ",e.jsx("button",{className:"h-9 rounded-md border border-border bg-card px-3 text-sm",onClick:pe,children:" + Add contract "})]})]}),$.length===0?e.jsx("div",{className:"text-sm text-muted",children:"No contracts yet. Add one from the transaction screen or here."}):e.jsx("ul",{className:"space-y-2",children:$.map(t=>e.jsx("li",{className:"w-full",children:e.jsx("div",{className:"w-full rounded-lg border border-border bg-card px-4 py-3",children:e.jsxs("div",{className:"grid gap-3 sm:gap-x-6 sm:gap-y-2 sm:grid-cols-[160px_90px_minmax(0,1fr)_110px] sm:items-start",children:[e.jsx("div",{className:"min-w-0 font-medium",children:t.name}),e.jsx("div",{className:"min-w-0 text-xs text-muted-foreground sm:pt-1",children:V[t.chainId]??t.chainId}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-muted-foreground font-mono break-words sm:truncate sm:break-normal",title:t.address??"",children:t.address}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:t.tags.map(s=>e.jsxs("span",{className:"rounded-full border border-border px-2 py-0.5",children:["#",s]},s))})]}),e.jsx("div",{className:"justify-self-start sm:justify-self-end",children:e.jsxs("details",{className:"relative inline-block",children:[e.jsx("summary",{className:"cursor-pointer list-none rounded-md border border-border bg-background px-2 py-1 text-xs",children:"Actions"}),e.jsxs("div",{className:"absolute left-0 sm:right-0 sm:left-auto mt-1 w-40 rounded-md border border-border bg-background shadow-lg z-50",children:[e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),fe(t)},children:"Edit"}),e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),xe(t,!(q[t.id]?.isVisible??!0))},children:q[t.id]?.isVisible??!0?"Hide":"Show"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs text-red-600 hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),_(t.id)},children:"Remove"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.preventDefault(),s.stopPropagation(),m(Ce(t))},children:"Share"})]})]})})]})})},t.id))}),u?Q.createPortal(e.jsx("div",{className:"bg-background/80 backdrop-blur-sm",onClick:t=>{t.target===t.currentTarget&&D()},style:{position:"fixed",inset:0,zIndex:2147483647,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{className:"bg-background",onMouseDown:t=>t.stopPropagation(),style:{width:"100%",maxWidth:448,borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[e.jsx("h2",{className:"mb-3 text-base font-semibold",children:p?"Edit contract":"Add contract"}),e.jsxs("form",{className:"space-y-4",onSubmit:be,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Name"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm",value:x,onChange:t=>O(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Address or ENS"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm",value:Y,onChange:t=>{const s=t.target.value.trim(),n=ae.test(s),f=oe.test(s);(s===""||n||f)&&P(t.target.value)}})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Chain"}),e.jsx("select",{className:"w-full rounded-md border px-2 py-1 text-sm",value:G,onChange:t=>R(Number(t.target.value)),children:Object.entries(V).map(([t,s])=>e.jsx("option",{value:t,children:s},t))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"ABI (JSON)"}),e.jsx("textarea",{className:"w-full rounded-md border px-2 py-1 text-sm",rows:6,value:z,onChange:t=>{const s=t.target.value;if(s.trim()===""){N(s);return}try{const n=JSON.parse(s);typeof n=="object"&&n!==null&&N(s)}catch{}}})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-md border px-2 py-1 text-sm",placeholder:"Type a tag and press Enter or comma…",value:K,onChange:t=>M(t.target.value),onKeyDown:t=>{(t.key==="Enter"||t.key===",")&&(t.preventDefault(),te())}}),e.jsx("button",{type:"button",className:"rounded-md border px-2 py-1 text-xs",onClick:te,children:"Add"})]}),I.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-muted",children:I.map(t=>e.jsxs("button",{type:"button",className:"flex items-center gap-1 rounded-full border px-2 py-0.5",onClick:()=>he(t),title:"Click to remove",children:[e.jsxs("span",{children:["#",t]}),e.jsx("span",{"aria-hidden":!0,children:"×"})]},t))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"rounded-md border px-3 py-1 text-xs",onClick:D,children:" Cancel "})," ",e.jsxs("button",{type:"submit",className:"rounded-md bg-primary px-3 py-1 text-xs font-medium text-background",children:[" ",p?"Save changes":"Create contract"," "]})]})]})]})}),document.body):null,B?Q.createPortal(e.jsx("div",{onClick:t=>{t.target===t.currentTarget&&D()},style:{position:"fixed",inset:0,zIndex:2147483647,background:"rgba(0,0,0,0.35)",backdropFilter:"blur(6px)",overflowY:"auto",WebkitOverflowScrolling:"touch",padding:16,minHeight:"100dvh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{width:"min(448px, calc(100dvw - 32px))",borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)",background:"#fff",color:"#111",maxHeight:"calc(100dvh - 32px)",overflowY:"auto"},children:[e.jsx("h2",{className:"text-base font-semibold",children:"Delete contract?"}),e.jsx("p",{className:"mt-2 text-sm text-muted",children:"This will delete the contract and remove it from your address book. This action cannot be undone."}),e.jsxs("div",{className:"mt-4 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",children:[e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>_(null),children:"Cancel"}),e.jsx("button",{className:"rounded-md bg-primary px-3 py-1 text-sm text-background",onClick:()=>{B&&ce(B),_(null)},children:"Yes, delete contract"})]})]})}),document.body):null,c&&e.jsx(Se,{payload:c,onClose:()=>m(null)})]})}export{Pe as Contracts};
