import{a as d,j as e,R as V,u as Q,b as _}from"./vendor-react-C4KqQK9E.js";import{s as G,u as J}from"./useAddressList-BW61usEe.js";import{u as X,a as Y,D as ee,c as te,S as se,v as re,b as ne,P as oe,d as de,C as ae}from"./vendor-dnd-CTbvfi1l.js";import{e as ie,g as ce}from"./index-CIWIx-KU.js";import{u as le}from"./useCoinList-DrB-YNYw.js";import{u as ue}from"./useContacts-DNmaZ8iJ.js";import{u as me}from"./useContracts-DMMoimvH.js";import"./useAddresses-Dn19ycjZ.js";import"./vendor-viem-BanhIei1.js";import"./vendor-qr-BZDEmg8j.js";import"./vendor-firebase-CrtqWl9v.js";function xe({items:s,sortMode:a,onReorder:S,onHide:p,coins:k,contacts:A,contracts:I,onSendCoins:h,onUseContract:b}){const i=d.useMemo(()=>{const o=s.filter(c=>c.isVisible!==!1);return G(o,a)},[s,a]),g=X(Y(oe,{activationConstraint:{distance:5}}));function f(o){if(a!=="custom")return;const{active:c,over:m}=o;if(!m||c.id===m.id)return;const v=i.findIndex(l=>l.id===c.id),j=i.findIndex(l=>l.id===m.id);if(v===-1||j===-1)return;const y=ne(i,v,j).map((l,E)=>({...l,indexOrder:E}));S(y)}return e.jsx(ee,{sensors:g,collisionDetection:te,onDragEnd:f,children:e.jsx(se,{items:i.map(o=>o.id),strategy:re,children:e.jsx("div",{className:"space-y-2",children:i.map(o=>e.jsx(pe,{item:o,draggable:a==="custom",onHide:p,coins:k,contacts:A,onSendCoins:h,onUseContract:b,contracts:I},o.id))})})})}function pe({item:s,draggable:a,onHide:S,coins:p,contacts:k,contracts:A,onSendCoins:I,onUseContract:h}){const[b,i]=V.useState(""),[g,f]=V.useState(""),o=s.id.replace(/^address:/,""),c=o,m=s.isContact?k.find(t=>t.id===c):void 0,v=new Set(m?.wallets?.map(t=>t.chainId)??[]),j=s.isContact?p.filter(t=>v.has(t.chainId)):[],y=s.isContact?void 0:A.find(t=>t.id===o),l=y?ie(y.metadata):null,E=ce(l),{attributes:F,listeners:L,setNodeRef:R,transform:P,transition:n,isDragging:u}=de({id:s.id}),M={transform:ae.Transform.toString(P),transition:n,opacity:u?.6:1,cursor:a?"grab":"default"};return e.jsx("div",{ref:R,style:M,className:"w-full",children:e.jsx("div",{className:"w-full rounded-lg border border-border bg-card px-4 py-3",children:e.jsxs("div",{className:"grid gap-3 sm:gap-x-6 sm:gap-y-2 sm:grid-cols-[minmax(0,1fr)_110px] sm:items-start",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.group&&s.group.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:s.group.map(t=>e.jsxs("span",{className:"rounded-full border border-border px-2 py-0.5",children:["#",t]},t))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.isContact&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"h-7 rounded border border-border bg-background px-1 text-xs text-foreground",value:b,onChange:t=>i(t.target.value),children:[e.jsx("option",{value:"",children:"Coin…"}),j.map(t=>e.jsx("option",{value:t.id,children:t.symbol},t.id))]}),e.jsx("button",{disabled:!b,className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted disabled:opacity-40",onClick:()=>I(s,b),children:"Send"})]}),!s.isContact&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{className:"h-7 w-28 rounded border border-border bg-background px-1 text-xs text-foreground",value:g,onChange:t=>f(t.target.value),children:[e.jsx("option",{value:"",children:"Function…"}),E.map(t=>e.jsxs("option",{value:t.name,children:[t.name,"(",t.inputs.map(w=>w.type).join(","),")"]},`${t.name}(${t.inputs.map(w=>w.type).join(",")})`))]}),e.jsx("button",{disabled:!g,className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted disabled:opacity-40",onClick:()=>h(s,g),children:"Use"})]}),e.jsx("button",{type:"button",...a?{...F,...L}:{},className:"text-xs text-muted-foreground hover:text-foreground disabled:opacity-40",disabled:!a,children:"☰"}),e.jsx("button",{onClick:()=>S(s.id),className:"rounded-md border border-border bg-background px-2 py-1 text-xs hover:bg-muted",children:"Hide"})]})]})})})}function ke(){const s=Q(),[a,S]=d.useState(""),[p,k]=d.useState("nameAsc"),[A,I]=d.useState([]),[h,b]=d.useState("any"),[i,g]=d.useState(""),{address:f,loading:o,error:c,updateAddress:m}=J({query:a,sortMode:p,tags:A,tagMode:h}),{coins:v}=le({query:"",sortMode:"nameAsc",standard:"",chainId:0}),{contacts:j}=ue(),{contracts:y}=me();function l(n,u){s("/transactions",{state:{prefill:{mode:"transfer",addressId:n.id,coinId:u}}})}function E(n,u){s("/transactions",{state:{prefill:{mode:"contract",addressId:n.id,functionName:u}}})}function F({sortMode:n,setSortMode:u,tagSearch:M,setTagSearch:t,setTags:w,tagMode:q,setTagSearchMode:H}){const[C,U]=d.useState(!1),z=d.useRef(null),[B,W]=d.useState({top:0,left:0,width:320}),O=()=>U(!1),N=d.useCallback(()=>{if(!z.current)return;const r=z.current.getBoundingClientRect(),x=8,D=Math.min(360,window.innerWidth-x*2),T=r.bottom+8,$=r.right-D,K=Math.min(Math.max(x,$),window.innerWidth-D-x);W({top:T,left:K,width:D})},[]),Z=()=>{const r=!C;r&&N(),U(r)};return d.useEffect(()=>{if(!C)return;const r=x=>{x.key==="Escape"&&O()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[C]),d.useEffect(()=>{if(C)return window.addEventListener("resize",N),window.addEventListener("scroll",N,!0),()=>{window.removeEventListener("resize",N),window.removeEventListener("scroll",N,!0)}},[C,N]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:z,type:"button",className:"h-9 whitespace-nowrap rounded-md border border-border bg-card px-3 text-sm text-foreground",onClick:Z,children:"Sort / Filter"}),C&&typeof document<"u"&&_.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:O,style:{position:"fixed",inset:0,zIndex:9998,background:"rgba(0,0,0,0.35)"}}),e.jsxs("div",{className:"rounded-xl border border-border bg-card shadow-lg",style:{position:"fixed",zIndex:9999,top:B.top,left:B.left,width:B.width,padding:12},onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Sort"}),e.jsxs("select",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground",value:n,onChange:r=>u(r.target.value),children:[e.jsx("option",{value:"nameAsc",children:"Name (A → Z)"}),e.jsx("option",{value:"nameDesc",children:"Name (Z → A)"}),e.jsx("option",{value:"createdDesc",children:"Newest first"}),e.jsx("option",{value:"createdAsc",children:"Oldest first"})]}),e.jsx("div",{className:"my-3 border-t border-border"}),e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Filter by tags"}),e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground placeholder:text-muted",placeholder:"Comma-separated tags…",value:M,onChange:r=>{const x=r.target.value;t(x);const D=x.split(",").map(T=>T.trim()).filter(Boolean);w(D)}}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted",children:"Mode"}),e.jsxs("select",{className:"h-9 flex-1 rounded-md border border-border bg-background px-2 text-sm text-foreground",value:q,onChange:r=>H(r.target.value),children:[e.jsx("option",{value:"any",children:"Match any"}),e.jsx("option",{value:"all",children:"Match all"})]}),e.jsx("button",{type:"button",className:"h-9 rounded-md border border-border bg-card px-3 text-sm hover:bg-muted",onClick:()=>{t(""),w([]),H("any")},children:"Clear"})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"h-9 rounded-md bg-primary px-3 text-sm text-primary-foreground",onClick:O,children:"Done"})})]})]}),document.body)]})}const L=d.useMemo(()=>f.filter(n=>n.isVisible!==!1),[f]);async function R(n){await Promise.all(n.map((u,M)=>m(u.id,{indexOrder:M})))}async function P(n){await m(n,{isVisible:!1})}return o?e.jsx("div",{className:"p-4",children:"Loading Address…"}):c?e.jsx("div",{className:"p-4 text-red-600",children:c}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("h1",{className:"shrink-0 text-2xl leading-tight font-semibold text-foreground",children:"Address Book"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-card px-2 text-sm text-foreground placeholder:text-muted sm:max-w-md",placeholder:"Search by name or address…",value:a,onChange:n=>S(n.target.value)}),e.jsx("div",{className:"flex flex-wrap items-center justify-center gap-2",children:e.jsx(F,{sortMode:p,setSortMode:k,tagSearch:i,setTagSearch:g,setTags:I,tagMode:h,setTagSearchMode:b})})]}),e.jsx(xe,{items:L,sortMode:p,onReorder:R,onHide:P,coins:v,contacts:j,contracts:y,onSendCoins:l,onUseContract:E})]})}export{ke as AddressBook};
