import{a as r,j as e,b as V}from"./vendor-react-C4KqQK9E.js";import{u as Oe}from"./useCoinList-DrB-YNYw.js";import{u as ze}from"./index-CIWIx-KU.js";import{u as _e}from"./useDomains-CnoqE8XC.js";import{c as qe,S as He}from"./shareBuilders-BefOSag0.js";import{d as Ve,h as Be,j as B}from"./vendor-viem-BanhIei1.js";import"./vendor-qr-BZDEmg8j.js";import"./vendor-firebase-CrtqWl9v.js";function Ue(){const[W,ce]=r.useState(""),[Z,me]=r.useState("nameAsc"),[ue,xe]=r.useState([]),[Q,pe]=r.useState("any"),[he,be]=r.useState(""),[Y,fe]=r.useState(""),[G,ge]=r.useState(0),[A,I]=r.useState(!1),[d,D]=r.useState(null),[K,X]=r.useState(null),[$,f]=r.useState(""),[U,g]=r.useState(""),[J,v]=r.useState(18),[y,L]=r.useState(""),[j,T]=r.useState(1),[N,M]=r.useState("ERC20"),[w,C]=r.useState([]),[ee,S]=r.useState(""),[k,R]=r.useState(null),ve=/^0x[0-9a-fA-F]{40}$/,ye=/^[a-z0-9-]+\.eth$/i,F={1:"Ethereum",11155111:"Sepolia"},te=["NATIVE","ERC20","ERC721","ERC1155","ERC3643","ERC7943"],{coins:P,loading:je,error:se,addCoin:Ne,deleteCoin:we,updateCoin:Ce}=Oe({query:W,sortMode:Z,tags:ue,tagMode:Q,standard:Y,chainId:G}),{folios:re,updateFolio:ne}=ze(),{domains:Se}=_e(),[ae,O]=r.useState(!1),[oe,u]=r.useState(null),[ke,h]=r.useState(!1);function Ee({sortMode:t,setSortMode:s,tagSearch:n,setTagSearch:a,setTags:i,tagMode:l,setTagSearchMode:c}){const[x,ie]=r.useState(!1),z=r.useRef(null),[_,Me]=r.useState({top:0,left:0,width:320}),q=()=>ie(!1),p=r.useCallback(()=>{if(!z.current)return;const o=z.current.getBoundingClientRect(),m=8,b=Math.min(360,window.innerWidth-m*2),H=o.bottom+8,Fe=o.right-b,Pe=Math.min(Math.max(m,Fe),window.innerWidth-b-m);Me({top:H,left:Pe,width:b})},[]),Re=()=>{const o=!x;o&&p(),ie(o)};return r.useEffect(()=>{if(!x)return;const o=m=>{m.key==="Escape"&&q()};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[x]),r.useEffect(()=>{if(x)return window.addEventListener("resize",p),window.addEventListener("scroll",p,!0),()=>{window.removeEventListener("resize",p),window.removeEventListener("scroll",p,!0)}},[x,p]),e.jsxs(e.Fragment,{children:[e.jsx("button",{ref:z,type:"button",className:"h-9 whitespace-nowrap rounded-md border border-border bg-card px-3 text-sm text-foreground",onClick:Re,children:" Sort / Filter "}),x&&typeof document<"u"&&V.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:q,style:{position:"fixed",inset:0,zIndex:9998,background:"rgba(0,0,0,0.35)"}}),e.jsxs("div",{className:"rounded-xl border border-border bg-card shadow-lg",style:{position:"fixed",zIndex:9999,top:_.top,left:_.left,width:_.width,padding:12},onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Sort"}),e.jsxs("select",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground",value:t,onChange:o=>s(o.target.value),children:[e.jsx("option",{value:"nameAsc",children:"Name (A → Z)"}),e.jsx("option",{value:"nameDesc",children:"Name (Z → A)"}),e.jsx("option",{value:"symbolAsc",children:"Symbol (A → Z)"}),e.jsx("option",{value:"symbolDesc",children:"Symbol (Z → A)"}),e.jsx("option",{value:"chainIdAsc",children:"Chain ID (Low → High)"}),e.jsx("option",{value:"chainIdDesc",children:"Chain ID (High → Low)"}),e.jsx("option",{value:"createdDesc",children:"Newest first"}),e.jsx("option",{value:"createdAsc",children:"Oldest first"})]}),e.jsx("div",{className:"my-3 border-t border-border"}),e.jsx("div",{className:"mb-2 text-sm font-semibold",children:"Filter by tags"}),e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-background px-2 text-sm text-foreground placeholder:text-muted",placeholder:"Comma-separated tags…",value:n,onChange:o=>{const m=o.target.value;a(m);const b=m.split(",").map(H=>H.trim()).filter(Boolean);i(b)}}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted",children:"Mode"}),e.jsxs("select",{className:"h-9 flex-1 rounded-md border border-border bg-background px-2 text-sm text-foreground",value:l,onChange:o=>c(o.target.value),children:[e.jsx("option",{value:"any",children:"Match any"}),e.jsx("option",{value:"all",children:"Match all"})]}),e.jsx("button",{type:"button",className:"h-9 rounded-md border border-border bg-card px-3 text-sm hover:bg-muted",onClick:()=>{a(""),i([]),c("any")},children:"Clear"})]}),e.jsx("div",{className:"mt-3 flex justify-end",children:e.jsx("button",{type:"button",className:"h-9 rounded-md bg-primary px-3 text-sm text-primary-foreground",onClick:q,children:"Done"})})]})]}),document.body)]})}r.useEffect(()=>{function t(s){s.target.closest("details")||document.querySelectorAll("details[open]").forEach(a=>{a.removeAttribute("open")})}return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),r.useEffect(()=>{if(!A)return;const t=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=t}},[A]);function de(){f(""),L(""),C([]),T(1),S(""),g(""),v(18),M("ERC20"),O(!1),u(null),h(!1)}async function Ae(){const t=y.trim();if(!t)return;const s=Se.find(n=>n.chainId===j);if(!s){u("No domain found for this chain");return}O(!0),u(null),h(!1);try{const n=Ve({transport:Be(s.rpcUrl)}),a=t,[i,l,c]=await Promise.all([n.readContract({address:a,abi:B,functionName:"name"}).catch(()=>null),n.readContract({address:a,abi:B,functionName:"symbol"}).catch(()=>null),n.readContract({address:a,abi:B,functionName:"decimals"}).catch(()=>null)]);if(i==null&&l==null&&c==null){u("Could not read contract — check address and chain");return}typeof i=="string"&&f(i),typeof l=="string"&&g(l),typeof c=="number"&&v(c),h(!0)}catch{u("Lookup failed — check RPC connection")}finally{O(!1)}}function Ie(){D(null),de(),I(!0)}function De(t){D(t),f(t.name??""),L(t.address??""),T(t.chainId??1),C(t.tags??[]),S(""),g(t.symbol??""),v(t.decimals??18),M(t.type??"ERC20"),I(!0)}function E(){I(!1),D(null),de()}function le(){const t=ee.trim();if(!t)return;const s=t.split(",").map(n=>n.trim()).filter(Boolean);C(n=>{const a=new Set(n.map(l=>l.toLowerCase())),i=[...n];for(const l of s)a.has(l.toLowerCase())||i.push(l);return i}),S("")}function Le(t){C(s=>s.filter(n=>n!==t))}async function Te(t){t.preventDefault();const s=$.trim();if(!s)return;const n={name:s,address:y.trim()||void 0,chainId:j||void 0,tags:w.length>0?w:void 0,symbol:U.trim()||void 0,decimals:J,type:N};if(d)await Ce(d.id,n);else{const a=await Ne(n),i=a[a.length-1];for(const l of re)if(l.chainId===Number(j)){const c=l.wallet??[];await ne(l.id,{wallet:[...c,{coin:i.id,balance:BigInt(0)}]})}}E()}return je?e.jsx("div",{className:"p-4",children:"Loading coins…"}):se?e.jsx("div",{className:"p-4 text-red-600",children:se}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("h1",{className:"shrink-0 text-2xl leading-tight font-semibold text-foreground",children:"Coins"}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx("input",{className:"h-9 w-full rounded-md border border-border bg-card px-2 text-sm text-foreground placeholder:text-muted sm:max-w-md",placeholder:"Search by name or address…",value:W,onChange:t=>ce(t.target.value)}),e.jsxs("select",{className:"h-9 w-[140px] rounded-md border border-border bg-card px-2 text-sm text-foreground",value:G,onChange:t=>ge(Number(t.target.value)),children:[e.jsx("option",{value:0,children:"All chains"}),Object.entries(F).map(([t,s])=>e.jsx("option",{value:Number(t),children:s},t))]}),e.jsxs("select",{className:"h-9 w-[100px] rounded-md border border-border bg-card px-2 text-sm text-foreground",value:Y,onChange:t=>fe(t.target.value),children:[e.jsx("option",{value:"",children:"All standards"}),te.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(Ee,{sortMode:Z,setSortMode:me,tagSearch:he,setTagSearch:be,setTags:xe,tagMode:Q,setTagSearchMode:pe})," ",e.jsx("button",{className:"h-9 rounded-md border border-border bg-card px-3 text-sm",onClick:Ie,children:" + Add coin "})]})]}),P.length===0?e.jsx("div",{className:"text-sm text-muted",children:"No coins yet. Add one from the transaction screen or here."}):e.jsx("ul",{className:"space-y-2",children:P.map(t=>e.jsx("li",{className:"w-full",children:e.jsx("div",{className:"w-full rounded-lg border border-border bg-card px-4 py-3",children:e.jsxs("div",{className:"grid gap-3 sm:gap-x-6 sm:gap-y-2 sm:grid-cols-[160px_90px_minmax(0,1fr)_110px] sm:items-start",children:[e.jsx("div",{className:"min-w-0 font-medium",children:t.name}),e.jsx("div",{className:"min-w-0 text-xs text-muted-foreground sm:pt-1",children:t.symbol}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:t.type}),e.jsx("div",{className:"text-xs text-muted-foreground",children:F[t.chainId]??t.chainId}),e.jsx("div",{className:`
            mt-0.5 text-xs text-muted-foreground font-mono
            break-words
            sm:truncate sm:break-normal
          `,title:t.address??"",children:t.address}),t.tags?.length?e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:t.tags.map(s=>e.jsxs("span",{className:"rounded-full border border-border px-2 py-0.5",children:["#",s]},s))}):null]}),e.jsx("div",{className:"justify-self-start sm:justify-self-end",children:e.jsxs("details",{className:"relative inline-block",children:[e.jsx("summary",{className:"cursor-pointer list-none rounded-md border border-border bg-background px-2 py-1 text-xs",children:"Actions"}),e.jsxs("div",{className:"absolute left-0 sm:right-0 sm:left-auto mt-1 w-40 rounded-md border border-border bg-background shadow-lg z-50",children:[e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),De(t)},children:"Edit"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{className:"block w-full px-3 py-2 text-left text-xs text-red-600 hover:bg-muted",onClick:s=>{s.currentTarget.closest("details")?.removeAttribute("open"),R(t.id)},children:"Remove"}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsx("button",{type:"button",className:"block w-full px-3 py-2 text-left text-xs hover:bg-muted",onClick:s=>{s.preventDefault(),s.stopPropagation(),X(qe(t))},children:"Share"})]})]})})]})})},t.id))}),A?V.createPortal(e.jsx("div",{className:"bg-background/80 backdrop-blur-sm",onClick:t=>{t.target===t.currentTarget&&E()},style:{position:"fixed",inset:0,zIndex:2147483647,display:"flex",alignItems:"center",justifyContent:"center",padding:16},children:e.jsxs("div",{className:"bg-background",onMouseDown:t=>t.stopPropagation(),style:{width:"100%",maxWidth:448,borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)"},children:[e.jsx("h2",{className:"mb-3 text-base font-semibold",children:d?"Edit coin":"Add coin"}),e.jsxs("form",{className:"space-y-4",onSubmit:Te,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Chain"}),e.jsx("select",{className:"w-full rounded-md border px-2 py-1 text-sm",value:j,onChange:t=>{T(Number(t.target.value)),d||(h(!1),u(null))},disabled:!!d,children:Object.entries(F).map(([t,s])=>e.jsx("option",{value:t,children:s},t))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Standard"}),e.jsx("select",{className:"w-full rounded-md border px-2 py-1 text-sm",value:N,onChange:t=>M(t.target.value),disabled:!!d,children:te.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Address"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-md border px-2 py-1 text-sm",value:y,onChange:t=>{const s=t.target.value.trim(),n=ve.test(s),a=ye.test(s);(s===""||n||a)&&(L(t.target.value),d||(h(!1),u(null)))},disabled:!!d,required:!0}),!d&&N!=="NATIVE"&&e.jsx("button",{type:"button",className:"rounded-md border px-3 py-1 text-xs disabled:opacity-50",onClick:Ae,disabled:ae||!y.trim(),children:ae?"Looking up…":"Lookup"})]}),oe&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:oe})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Name"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm disabled:opacity-60 disabled:bg-muted",value:$,onChange:t=>f(t.target.value),readOnly:!d,required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Symbol"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm disabled:opacity-60 disabled:bg-muted",value:U,onChange:t=>g(t.target.value),readOnly:!d,required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Decimals"}),e.jsx("input",{className:"w-full rounded-md border px-2 py-1 text-sm disabled:opacity-60 disabled:bg-muted",value:J,onChange:t=>v(Number(t.target.value)),readOnly:!d,required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{className:"flex-1 rounded-md border px-2 py-1 text-sm",placeholder:"Type a tag and press Enter or comma…",value:ee,onChange:t=>S(t.target.value),onKeyDown:t=>{(t.key==="Enter"||t.key===",")&&(t.preventDefault(),le())}}),e.jsx("button",{type:"button",className:"rounded-md border px-2 py-1 text-xs",onClick:le,children:"Add"})]}),w.length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1 text-[10px] text-muted",children:w.map(t=>e.jsxs("button",{type:"button",className:"flex items-center gap-1 rounded-full border px-2 py-0.5",onClick:()=>Le(t),title:"Click to remove",children:[e.jsxs("span",{children:["#",t]}),e.jsx("span",{"aria-hidden":!0,children:"×"})]},t))})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"rounded-md border px-3 py-1 text-xs",onClick:E,children:" Cancel "})," ",e.jsxs("button",{type:"submit",className:"rounded-md bg-primary px-3 py-1 text-xs font-medium text-background",disabled:!d&&!ke&&N!=="NATIVE",children:[" ",d?"Save changes":"Create coin"," "]})]})]})]})}),document.body):null,k?V.createPortal(e.jsx("div",{onClick:t=>{t.target===t.currentTarget&&E()},style:{position:"fixed",inset:0,zIndex:2147483647,background:"rgba(0,0,0,0.35)",backdropFilter:"blur(6px)",overflowY:"auto",WebkitOverflowScrolling:"touch",padding:16,minHeight:"100dvh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsxs("div",{onClick:t=>t.stopPropagation(),style:{width:"min(448px, calc(100dvw - 32px))",borderRadius:12,padding:16,boxShadow:"0 10px 30px rgba(0,0,0,0.3)",background:"#fff",color:"#111",maxHeight:"calc(100dvh - 32px)",overflowY:"auto"},children:[e.jsx("h2",{className:"text-base font-semibold",children:"Delete coin?"}),e.jsx("p",{className:"mt-2 text-sm text-muted",children:"This will remove the coin from all pages. This action cannot be undone."}),e.jsxs("div",{className:"mt-4 flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",children:[e.jsx("button",{className:"rounded-md border px-3 py-1 text-sm",onClick:()=>R(null),children:"Cancel"}),e.jsx("button",{className:"rounded-md bg-primary px-3 py-1 text-sm text-background",onClick:async()=>{if(k){const t=P.find(s=>s.id===k);if(t){for(const s of re)if(s.chainId===t.chainId){const n=s.wallet??[],a=n.filter(i=>i.coin!==t.id);a.length!==n.length&&await ne(s.id,{wallet:a})}}we(k)}R(null)},children:"Yes, delete coin"})]})]})}),document.body):null,K&&e.jsx(He,{payload:K,onClose:()=>X(null)})]})}export{Ue as Coins};
